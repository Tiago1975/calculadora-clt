<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calculadora CLT</title>
  <style>
    :root {
      --laranja: #ff8c42;
      --roxo: #7b2cbf;
      --fundo: #f8f8ff;
      --texto: #333;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: var(--fundo);
      color: var(--texto);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      margin: 0;
      padding: 2rem;
    }

    h1 {
      color: var(--roxo);
      text-align: center;
      margin-bottom: 1rem;
    }

    .container {
      background: white;
      padding: 2rem;
      border-radius: 1.5rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 500px;
    }

    .periodo {
      display: flex;
      gap: 0.5rem;
      align-items: center;
      margin-bottom: 0.75rem;
    }

    .periodo input {
      flex: 1;
      padding: 0.5rem;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 0.5rem;
    }

    .botao {
      background: linear-gradient(45deg, var(--laranja), var(--roxo));
      border: none;
      color: white;
      padding: 0.75rem 1rem;
      border-radius: 1rem;
      cursor: pointer;
      font-size: 1rem;
      transition: 0.3s;
    }

    .botao:hover {
      opacity: 0.9;
    }

    #resultado {
      margin-top: 1.5rem;
      font-size: 1.2rem;
      text-align: center;
      font-weight: bold;
      color: var(--roxo);
    }

    #botoes-acao {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }

    .add-remove {
      display: flex;
      justify-content: space-between;
      margin-bottom: 1rem;
    }

    #historico {
      margin-top: 2rem;
      background: #fafafa;
      border-radius: 1rem;
      padding: 1rem;
      font-size: 0.95rem;
      box-shadow: inset 0 0 5px rgba(0,0,0,0.05);
    }

    #historico h2 {
      margin-top: 0;
      color: var(--laranja);
    }

    .item-historico {
      display: flex;
      justify-content: space-between;
      border-bottom: 1px solid #eee;
      padding: 0.25rem 0;
    }

    .item-historico:last-child {
      border-bottom: none;
    }

    .acoes-historico {
      display: flex;
      justify-content: space-between;
      margin-top: 1rem;
      gap: 0.5rem;
    }

    @media (max-width: 480px) {
      .periodo {
        flex-direction: column;
      }
      #botoes-acao {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>

  <h1>Calculadora CLT</h1>

  <div class="container">
    <div class="add-remove">
      <button class="botao" id="addPeriodo">+ Adicionar Per√≠odo</button>
      <button class="botao" id="removerPeriodo">‚Äì Remover</button>
    </div>

    <div id="periodos"></div>

    <div id="resultado">Insira seus hor√°rios</div>

    <div id="botoes-acao">
      <button class="botao" id="btnCompartilhar">üì§ Compartilhar</button>
    </div>

    <div id="historico">
      <h2>Hist√≥rico</h2>
      <div id="listaHistorico">Nenhum registro ainda.</div>
      <div class="acoes-historico">
        <button class="botao" id="limparHistorico">üóëÔ∏è Limpar Hist√≥rico</button>
        <button class="botao" id="exportarCSV">üìÑ Exportar CSV</button>
      </div>
    </div>
  </div>

  <script>
    const periodosDiv = document.getElementById("periodos");
    const resultadoDiv = document.getElementById("resultado");
    const listaHistorico = document.getElementById("listaHistorico");
    const btnCompartilhar = document.getElementById("btnCompartilhar");
    let textoResultado = "";

    function criarPeriodo() {
      const div = document.createElement("div");
      div.classList.add("periodo");
      div.innerHTML = `
        <input type="time" class="entrada" /> 
        <span>‚Üí</span>
        <input type="time" class="saida" />
      `;
      div.querySelectorAll("input").forEach(inp => inp.addEventListener("input", calcularHoras));
      periodosDiv.appendChild(div);
      calcularHoras();
    }

    function removerPeriodo() {
      if (periodosDiv.children.length > 1) {
        periodosDiv.removeChild(periodosDiv.lastChild);
        calcularHoras();
      }
    }

    function calcularHoras() {
      let totalMinutos = 0;

      document.querySelectorAll(".periodo").forEach((p) => {
        const entrada = p.querySelector(".entrada").value;
        const saida = p.querySelector(".saida").value;

        if (entrada && saida) {
          const [h1, m1] = entrada.split(":").map(Number);
          const [h2, m2] = saida.split(":").map(Number);
          let minutos = (h2 * 60 + m2) - (h1 * 60 + m1);
          if (minutos < 0) minutos += 24 * 60;
          totalMinutos += minutos;
        }
      });

      if (totalMinutos === 0) {
        resultadoDiv.textContent = "Insira seus hor√°rios";
        textoResultado = "";
        return;
      }

      const horas = Math.floor(totalMinutos / 60);
      const minutos = totalMinutos % 60;
      textoResultado = `Voc√™ trabalhou ${horas}h ${minutos.toString().padStart(2, '0')}min hoje.`;
      resultadoDiv.textContent = textoResultado;

      salvarNoHistorico(horas, minutos);
    }

    function salvarNoHistorico(horas, minutos) {
      const data = new Date();
      const dataStr = data.toLocaleDateString('pt-BR');
      const registro = { data: dataStr, horas, minutos };

      let historico = JSON.parse(localStorage.getItem("historicoCLT")) || [];
      const existente = historico.findIndex(h => h.data === dataStr);
      if (existente >= 0) {
        historico[existente] = registro;
      } else {
        historico.unshift(registro);
      }

      localStorage.setItem("historicoCLT", JSON.stringify(historico));
      exibirHistorico();
    }

    function exibirHistorico() {
      const historico = JSON.parse(localStorage.getItem("historicoCLT")) || [];
      if (historico.length === 0) {
        listaHistorico.textContent = "Nenhum registro ainda.";
        return;
      }

      listaHistorico.innerHTML = historico
        .map(h => `
          <div class="item-historico">
            <span>üìÖ ${h.data}</span>
            <strong>${h.horas}h ${h.minutos.toString().padStart(2,'0')}min</strong>
          </div>
        `)
        .join("");
    }

    function exportarCSV() {
      const historico = JSON.parse(localStorage.getItem("historicoCLT")) || [];
      if (historico.length === 0) {
        alert("Nenhum hist√≥rico para exportar.");
        return;
      }

      let csv = "Data;Horas;Minutos\n";
      historico.forEach(h => {
        csv += `${h.data};${h.horas};${h.minutos}\n`;
      });

      const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
      const url = URL.createObjectURL(blob);

      const a = document.createElement("a");
      a.href = url;
      a.download = "historico_clt.csv";
      a.click();

      URL.revokeObjectURL(url);
    }

    async function compartilharResultado() {
      if (!textoResultado) {
        alert("Calcule primeiro as horas antes de compartilhar!");
        return;
      }

      const msg = `üìÖ Calculadora CLT\n${textoResultado}`;

      if (navigator.share) {
        try {
          await navigator.share({
            title: "Calculadora CLT",
            text: msg
          });
        } catch (err) {
          console.log("Compartilhamento cancelado:", err);
        }
      } else {
        navigator.clipboard.writeText(msg);
        alert("üìã Texto copiado! Agora √© s√≥ colar onde quiser.");
      }
    }

    document.getElementById("addPeriodo").addEventListener("click", criarPeriodo);
    document.getElementById("removerPeriodo").addEventListener("click", removerPeriodo);
    document.getElementById("limparHistorico").addEventListener("click", () => {
      localStorage.removeItem("historicoCLT");
      exibirHistorico();
    });
    document.getElementById("exportarCSV").addEventListener("click", exportarCSV);
    btnCompartilhar.addEventListener("click", compartilharResultado);

    criarPeriodo();
    criarPeriodo();
    exibirHistorico();
  </script>

</body>
</html>
